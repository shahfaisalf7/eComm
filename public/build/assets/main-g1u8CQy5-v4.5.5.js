import{E as n}from"./Errors-C30A2Jtx-v4.5.5.js";Alpine.data("Addresses",({initialAddresses:a,initialDefaultAddress:r,countries:o})=>({addresses:a,defaultAddress:r,countries:o,formOpen:!1,editing:!1,loading:!1,form:{state:""},states:{},cities:{},zones:{},errors:new n,get firstCountry(){return Object.keys(this.countries)[0]},get hasAddress(){return Object.keys(this.addresses).length!==0},get hasNoStates(){return Object.keys(this.states).length===0},get hasNoCities(){return Object.keys(this.cities).length===0},get hasNoZones(){return Object.keys(this.zones).length===0},init(){this.changeCountry(this.firstCountry)},changeDefaultAddress(t){this.defaultAddress.address_id!==t.id&&(this.defaultAddress.address_id=t.id,axios.post(route("account.addresses.change_default"),{address_id:t.id}).then(e=>{notify(e.data)}).catch(e=>{notify(e.response.data.message)}))},changeCountry(t){this.form.country=t,this.form.state="",this.fetchStates(t)},changeState(t){this.form.state=t,this.form.city="",this.form.zone="",this.fetchCities(t)},changeCity(t){this.form.city=t,this.form.zone="",this.fetchZones(t)},async fetchStates(t,e=""){const s=await axios.get(route("countries.states.index",{code:t}));if(this.states=s.data,e){$("#state option").each(function(){$(this).text()===e.state&&$(this).prop("selected",!0)});var i=$("#state").val();await this.fetchCities(i,e)}},async fetchCities(t,e=""){const s=await axios.get(route("states.cities.index",{code:t}));this.cities=s.data,setTimeout(()=>{if(e){$("#city option").each(function(){$(this).text()===e.city&&$(this).prop("selected",!0)});var i=$("#city").val();this.fetchZones(i,e)}},1e3)},async fetchZones(t,e=""){const s=await axios.get(route("cities.zones.index",{code:t}));this.zones=s.data,setTimeout(()=>{e&&$("#zone option").each(function(){$(this).text()===e.zone&&$(this).prop("selected",!0)})},1e3)},edit(t){this.formOpen=!0,this.editing=!0,this.form=t,this.fetchStates(t.country,t)},remove(t){confirm(trans("storefront::account.addresses.confirm"))&&axios.delete(route("account.addresses.destroy",t.id)).then(e=>{delete this.addresses[t.id],notify(e.data.message)}).catch(e=>{notify(e.response.data.message)})},cancel(){this.editing=!1,this.formOpen=!1,this.errors.reset(),this.resetForm()},save(){this.loading=!0,this.editing?this.update():this.create()},update(){var t=$("#zone").val();this.form.zone=t,axios.put(route("account.addresses.update",{id:this.form.id}),this.form).then(({data:e})=>{this.formOpen=!1,this.editing=!1,this.addresses[this.form.id]=e.address,this.resetForm(),notify(e.message)}).catch(({response:e})=>{e.status===422&&this.errors.record(e.data.errors),notify(e.data.message)}).finally(()=>{this.loading=!1})},create(){axios.post(route("account.addresses.store"),this.form).then(({data:t})=>{this.formOpen=!1;let e={[t.address.id]:t.address};this.addresses={...this.addresses,...e},this.resetForm(),notify(t.message)}).catch(({response:t})=>{t.status===422&&this.errors.record(t.data.errors),notify(t.data.message)}).finally(()=>{this.loading=!1})},resetForm(){this.form={state:""}}}));
