import{t as r}from"./wysiwyg-AQZLtIQl-v4.5.5.js";import"./tinymce-DrzM0P0W-v4.5.5.js";import"./@popperjs-ZDRvRZ2v-v4.5.5.js";class s{constructor(e,t){this.selector=t,$.jstree.defaults.dnd.touch=!0,$.jstree.defaults.dnd.copy=!1,this.fetchCategoryTree(),t.on("select_node.jstree",(a,o)=>e.fetchCategory(o.selected[0])),t.on("loaded.jstree",()=>t.jstree("open_all")),this.selector.on("move_node.jstree",(a,o)=>{this.updateCategoryTree(o)})}fetchCategoryTree(){this.selector.jstree({core:{data:{url:route("admin.categories.tree")},check_callback:!0},plugins:["dnd"]})}updateCategoryTree(e){this.loading(e.node,!0),$.ajax({type:"PUT",url:route("admin.categories.tree.update"),data:{category_tree:this.getCategoryTree()},success:t=>{success(t),this.loading(e.node,!1)},error:t=>{error(t.responseJSON.message),this.loading(e.node,!1)}})}getCategoryTree(){return this.selector.jstree(!0).get_json("#",{flat:!0}).reduce((t,a)=>t.concat({id:a.id,parent_id:a.parent==="#"?null:a.parent,position:a.data.position}),[])}loading(e,t){let a=this.selector.jstree().get_node(e,!0);t?$(a).addClass("jstree-loading"):$(a).removeClass("jstree-loading")}}class l{constructor(){console.log("CategoryForm Initialized - Timestamp:",Date.now());let e=$(".category-tree");new s(this,e),this.collapseAll(e),this.expandAll(e),this.addRootCategory(),this.addSubCategory(),$("#category-form").on("submit",this.submit),window.admin.removeSubmitButtonOffsetOn("#image",".category-details-tab li > a"),this.initTinyMCE()}initTinyMCE(){this.textEditor=r({setup:e=>{e.on("change",()=>{e.save()})}})}fetchCategory(e){this.loading(!0),$(".add-sub-category").removeClass("disabled"),$.ajax({type:"GET",url:route("admin.categories.show",e),success:t=>{console.log("Fetch Success:",t),this.update(t),this.loading(!1)},error:t=>{error(t.responseJSON.message),this.loading(!1)}})}update(e){console.log("Update Called with:",e),console.log("Meta Title Input:",$('input[name="meta[meta_title]"]').length),console.log("Meta Desc Input:",$('textarea[name="meta[meta_description]"]').length),console.log("Meta Title Value:",e.meta_data?.[0]?.meta_title),console.log("Meta Desc Value:",e.meta_data?.[0]?.meta_description),window.form.removeErrors(),$(".btn-delete").removeClass("hide"),$(".form-group .help-block").remove(),$("#confirmation-form").attr("action",route("admin.categories.destroy",e.id)),$("#id-field").removeClass("hide"),$("#id").val(e.id),$("#name").val(e.name),$("#slug").val(e.slug),$('input[name="meta[meta_title]"]').val(e.meta_data?.[0]?.meta_title||""),$('textarea[name="meta[meta_description]"]').val(e.meta_data?.[0]?.meta_description||""),$("#description").val(e.description||""),this.textEditor&&this.textEditor.get("description")&&this.textEditor.get("description").setContent(e.description||""),$("#is_searchable").prop("checked",e.is_searchable),$("#is_active").prop("checked",e.is_active),$(".logo .image-holder-wrapper").html(this.categoryImage("logo",e.logo)),$(".banner .image-holder-wrapper").html(this.categoryImage("banner",e.banner)),$('#category-form input[name="parent_id"]').remove(),console.log("After Set - Meta Title:",$('input[name="meta[meta_title]"]').val()),console.log("After Set - Meta Desc:",$('textarea[name="meta[meta_description]"]').val()),console.log("After Set - Description:",$("#description").val())}categoryImage(e,t){return t.exists?`
            <div class="image-holder">
                <img src="${t.path}">
                <button type="button" class="btn remove-image" data-input-name="files[${e}]">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M6.00098 17.9995L17.9999 6.00053" stroke="#292D32" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M17.9999 17.9995L6.00098 6.00055" stroke="#292D32" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
                <input type="hidden" name="files[${e}]" value="${t.id}">
            </div>
        `:this.imagePlaceholder()}clear(){$("#id-field").addClass("hide"),$("#id").val(""),$("#name").val(""),$("#slug").val(""),$('input[name="meta[meta_title]"]').val(""),$('textarea[name="meta[meta_description]"]').val(""),$("#description").val(""),this.textEditor&&this.textEditor.get("description")&&this.textEditor.get("description").setContent(""),$("#is_searchable").prop("checked",!1),$("#is_active").prop("checked",!1),$(".logo .image-holder-wrapper").html(this.imagePlaceholder()),$(".banner .image-holder-wrapper").html(this.imagePlaceholder()),$(".btn-delete").addClass("hide"),$(".form-group .help-block").remove(),$('#category-form input[name="parent_id"]').remove(),$(".general-information-tab a").click()}imagePlaceholder(){return`
            <div class="image-holder placeholder">
                <i class="fa fa-picture-o"></i>
            </div>
        `}loading(e){e===!0?$(".overlay.loader").removeClass("hide"):$(".overlay.loader").addClass("hide")}submit(e){let t=$(".category-tree").jstree("get_selected")[0];t!==void 0&&(window.form.appendHiddenInput("#category-form","_method","PUT"),$("#category-form").attr("action",route("admin.categories.update",t))),e.currentTarget.submit()}collapseAll(e){$(".collapse-all").on("click",t=>{t.preventDefault(),e.jstree("close_all")})}expandAll(e){$(".expand-all").on("click",t=>{t.preventDefault(),e.jstree("open_all")})}addRootCategory(){$(".add-root-category").on("click",()=>{this.loading(!0),$(".add-sub-category").addClass("disabled"),$(".category-tree").jstree("deselect_all"),this.clear(),setTimeout(this.loading,150,!1)})}addSubCategory(){$(".add-sub-category").on("click",()=>{let e=$(".category-tree").jstree("get_selected")[0];e!==void 0&&(this.clear(),this.loading(!0),window.form.appendHiddenInput("#category-form","parent_id",e),setTimeout(this.loading,150,!1))})}}console.log("Main JS Loaded - Timestamp:",Date.now());console.log("DEBUG MARKER: Meta Fix Loaded");new l;
